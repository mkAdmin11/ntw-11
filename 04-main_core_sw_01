
en
conf t

hostname main_core_sw_01

clock timezone MSK 3
ntp server 172.17.1.126
ntp trusted-key 4294967282

ip name-server 172.17.1.126
! no ip domain-lookup

service password-encryption

aaa new-model

username admin privilege 15 secret passwd
enable secret passwd

tacacs-server host 172.17.1.126 key passwd

aaa authentication login CON local 
aaa authentication login SSH group tacacs+ 
aaa authentication enable default enable 

ip ssh version 2
ip ssh time-out 60
ip ssh authentication-retries 3

ip domain-name my.local
crypto key generate rsa
1024

no ip access-list extended SSH_ACL
ip access-list extended SSH_ACL
remark ADMINISTRATOR
1 permit tcp host 172.17.1.99 any eq 22
remark DENY_ANY
10 deny ip any any
exit

line con 0
login authentication CON
privilege level 15
exit

line aux 0
login authentication CON
privilege level 15
exit

line vty 0 4
access-class SSH_ACL in
login authentication SSH
transport input ssh
privilege level 15
exit

vlan 100
name MGMT
exit

vlan 200
name USERS
exit

vlan 300
name WLAN
exit

vlan 400
name VOIP
exit

vlan 500
name PRINT
exit

spanning-tree mode rapid-pvst
spanning-tree vlan 1,100,200,300,400,500,1002-1005 root primary

ip dhcp snooping
ip dhcp snooping vlan 1,100,200,300,400,500,1002-1005
ip dhcp snooping information option allow-untrusted
! ip dhcp relay information trust-all

interface Loopback0
description MGMT
ip address 172.16.255.3 255.255.255.255
! ip access-group SSH_ACL in
exit

interface Vlan100
description MGMT
ip access-group MGMT_ACL in
ip access-group MGMT_ACL out
ip address 172.17.1.1 255.255.255.128
standby version 2
standby 1 ip 172.17.1.3
standby 1 priority 101
standby 1 preempt
standby preempt
exit

interface Vlan200
description USERS
ip access-group USERS_ACL in
ip access-group USERS_ACL out
ip address 172.17.2.1 255.255.255.0
ip helper-address 172.17.1.126
standby version 2
standby 2 ip 172.17.2.3
standby 2 priority 101
standby 2 preempt
standby preempt
exit

interface Vlan300
description WLAN
ip access-group WLAN_ACL in
ip access-group WLAN_ACL out
ip address 172.17.3.1 255.255.255.0
ip helper-address 172.17.1.126
standby version 2
standby 3 ip 172.17.3.3
standby 3 priority 101
standby 3 preempt
standby preempt
exit

interface Vlan400
description VOIP
ip access-group VOIP_ACL in
ip access-group VOIP_ACL out
ip address 172.17.4.1 255.255.255.0
ip helper-address 172.17.1.126
standby version 2
standby 4 ip 172.17.4.3
standby 4 priority 101
standby 4 preempt
standby preempt
exit

interface Vlan500
description PRINT
ip access-group PRINT_ACL in
ip access-group PRINT_ACL out
ip address 172.17.5.1 255.255.255.128
ip helper-address 172.17.1.126
standby version 2
standby 5 ip 172.17.5.3
standby 5 priority 101
standby 5 preempt
standby preempt
exit

interface range fastEthernet 0/1-2
description MAIN_ACCESS_LAYER
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk allowed vlan 100,200,300,400,500
no shutdown
exit

interface fastEthernet 0/3
description MAIN_ACCESS_LAYER_&_INFRASTRUCTURE
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk allowed vlan 100,200,300,400,500
ip dhcp snooping trust
no shutdown
exit

interface range fastEthernet 0/4-22
shutdown
exit

interface range fastEthernet 0/23-24
description PORT-CHANNEL1
channel-group 1 mode active
ip dhcp snooping trust
no shutdown
exit

interface Port-channel1
description RESERVE_MAIN_CORE_SW_02
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk allowed vlan 100,200,300,400,500
exit

interface GigabitEthernet0/1
description UPLINK_MAIN_ASA_01
no switchport
ip address 172.16.1.14 255.255.255.252
ip ospf cost 1
no shutdown
exit

interface GigabitEthernet0/2
shutdown
exit

ip routing

router ospf 65528
router-id 0.1.3.1
! auto-cost reference-bandwidth 1000
area 1 nssa no-summary
network 172.16.0.0 0.15.255.255 area 1
! network 172.16.1.12 0.0.0.3 area 1
! network 172.17.0.0 0.0.255.255 area 1
! network 172.16.255.3 0.0.0.0 area 1
passive-interface Loopback0
passive-interface vlan 200
passive-interface vlan 300
passive-interface vlan 400
passive-interface vlan 500
exit

no ip access-list extended MGMT_ACL
ip access-list extended MGMT_ACL
remark DHCP
11 permit udp host 0.0.0.0 eq 68 host 255.255.255.255 eq 67
12 permit udp host 172.17.1.126 eq 67 172.16.0.0 0.15.255.255 range 67 68
13 permit icmp host 172.17.1.126 172.16.0.0 0.15.255.255
14 permit icmp 172.16.0.0 0.15.255.255 host 172.17.1.126
remark BRANCH1_WLC
21 permit udp host 172.18.1.60 host 172.17.1.125 range 5246 5247
22 permit udp host 172.17.1.125 range 5246 5247 host 172.18.1.60
remark DNS
31 permit udp 172.16.0.0 0.15.255.255 host 172.17.1.126 eq 53
32 permit udp host 172.17.1.126 eq 53 172.16.0.0 0.15.255.255
33 permit udp host 172.17.1.126 host 8.8.8.8 eq 53
34 permit udp host 8.8.8.8 eq 53 host 172.17.1.126
remark NTP
41 permit udp 172.16.0.0 0.15.255.255 host 172.17.1.126 eq 123
42 permit udp host 172.17.1.126 eq 123 172.16.0.0 0.15.255.255
remark AAA
51 permit tcp 172.16.0.0 0.15.255.255 host 172.17.1.126 eq 49
52 permit tcp host 172.17.1.126 eq 49 172.16.0.0 0.15.255.255
53 permit udp 172.16.0.0 0.15.255.255 host 172.17.1.126 eq 1645
54 permit udp host 172.17.1.126 eq 1645 172.16.0.0 0.15.255.255
remark OSPF
61 permit ospf host 172.17.1.1 host 224.0.0.5
62 permit ospf host 172.17.1.2 host 224.0.0.5
63 permit ospf host 172.17.1.1 host 172.17.1.2
64 permit ospf host 172.17.1.2 host 172.17.1.1
remark HSRP
71 permit ip 172.17.1.0 0.0.0.127 host 224.0.0.102
72 permit ip host 224.0.0.102 172.17.1.0 0.0.0.127
73 permit ip host 224.0.0.102 host 224.0.0.102
remark WEB_SERVER
81 permit tcp 172.16.0.0 0.15.255.255 172.16.100.0 0.0.0.63 eq 80
82 permit tcp 172.16.100.0 0.0.0.63 eq 80 172.16.0.0 0.15.255.255
83 permit tcp 172.16.0.0 0.15.255.255 172.16.100.0 0.0.0.63 eq 443
84 permit tcp 172.16.100.0 0.0.0.63 eq 443 172.16.0.0 0.15.255.255
remark ADMINISTATOR
91 permit tcp 172.16.0.0 0.15.255.255 eq 22 host 172.17.1.99
92 permit tcp host 172.17.1.99 172.16.0.0 0.15.255.255 eq 22
93 permit icmp host 172.17.1.99 172.16.0.0 0.15.255.255
94 permit icmp 172.16.0.0 0.15.255.255 host 172.17.1.99
remark DENY_ANY
100 deny ip any any
exit

no ip access-list extended USERS_ACL
ip access-list extended USERS_ACL
remark PRINT_NETWORK
11 permit ip 172.17.2.0 0.0.0.255 172.17.5.0 0.0.0.127
12 permit ip 172.17.5.0 0.0.0.127 172.17.2.0 0.0.0.255
remark INTERNET
21 permit ip 172.17.2.0 0.0.0.255 8.8.8.0 0.0.0.255
22 permit ip 8.8.8.0 0.0.0.255 172.17.2.0 0.0.0.255
remark WEB_SERVER
31 permit ip 172.17.2.0 0.0.0.255 172.16.100.0 0.0.0.63
32 permit ip 172.16.100.0 0.0.0.63 172.17.2.0 0.0.0.255
remark DHCP
41 permit udp host 0.0.0.0 eq 68 host 255.255.255.255 eq 67
42 permit udp 172.17.1.126 0.0.0.0 eq 67 172.17.2.0 0.0.0.255 range 67 68
43 permit icmp host 172.17.1.126 172.17.2.0 0.0.0.255
44 permit icmp 172.17.2.0 0.0.0.255 host 172.17.1.126
remark DNS
51 permit udp 172.17.2.0 0.0.0.255 host 172.17.1.126 eq 53
52 permit udp host 172.17.1.126 eq 53 172.17.2.0 0.0.0.255
remark HSRP
71 permit ip 172.17.2.0 0.0.0.255 host 224.0.0.102
72 permit ip host 224.0.0.102 172.17.2.0 0.0.0.255
73 permit ip host 224.0.0.102 host 224.0.0.102
remark DENY_ANY
100 deny ip any any
exit

no ip access-list extended WLAN_ACL
ip access-list extended WLAN_ACL
remark INTERNET
11 permit ip 172.17.3.0 0.0.0.255 8.8.8.0 0.0.0.255
12 permit ip 8.8.8.0 0.0.0.255 172.17.3.0 0.0.0.255
remark WEB_SERVER
21 permit ip 172.17.3.0 0.0.0.255 host 172.2.0.2
22 permit ip host 172.2.0.2 172.17.3.0 0.0.0.255
remark DHCP
31 permit udp host 0.0.0.0 eq 68 host 255.255.255.255 eq 67
32 permit udp 172.17.1.126 0.0.0.0 eq 67 172.17.3.0 0.0.0.255 range 67 68
33 permit icmp host 172.17.1.126 172.17.3.0 0.0.0.255
34 permit icmp 172.17.3.0 0.0.0.255 host 172.17.1.126
remark DNS
53 permit udp 172.17.3.0 0.0.0.255 host 8.8.8.8 eq 53
54 permit udp host 8.8.8.8 eq 53 172.17.3.0 0.0.0.255
remark HSRP
71 permit ip 172.17.3.0 0.0.0.255 host 224.0.0.102
72 permit ip host 224.0.0.102 172.17.3.0 0.0.0.255
73 permit ip host 224.0.0.102 host 224.0.0.102
remark DENY_ANY
100 deny ip any any
exit

no ip access-list extended VOIP_ACL
ip access-list extended VOIP_ACL
remark VOICE_NETWORK
11 permit ip 172.17.4.0 0.0.0.255 172.18.4.0 0.0.0.63
12 permit ip 172.18.4.0 0.0.0.63 172.17.4.0 0.0.0.255
remark DHCP
21 permit udp host 0.0.0.0 eq 68 host 255.255.255.255 eq 67
22 permit udp 172.17.1.126 0.0.0.0 eq 67 172.17.4.0 0.0.0.255 range 67 68
23 permit icmp host 172.17.1.126 172.17.4.0 0.0.0.255
24 permit icmp 172.17.4.0 0.0.0.255 host 172.17.1.126
remark DNS
51 permit udp 172.17.4.0 0.0.0.255 host 172.17.1.126 eq 53
52 permit udp host 172.17.1.126 eq 53 172.17.4.0 0.0.0.255
remark HSRP
71 permit ip 172.17.4.0 0.0.0.255 host 224.0.0.102
72 permit ip host 224.0.0.102 172.17.4.0 0.0.0.255
73 permit ip host 224.0.0.102 host 224.0.0.102
remark DENY_ANY
100 deny ip any any
exit

no ip access-list extended PRINT_ACL
ip access-list extended PRINT_ACL
remark USERS_NETWORK
11 permit ip 172.17.5.0 0.0.0.127 172.17.2.0 0.0.0.255
12 permit ip 172.17.2.0 0.0.0.255 172.17.5.0 0.0.0.127
13 permit ip 172.17.5.0 0.0.0.127 172.18.2.0 0.0.0.127
14 permit ip 172.18.2.0 0.0.0.127 172.17.5.0 0.0.0.127
remark DHCP
21 permit udp host 0.0.0.0 eq 68 host 255.255.255.255 eq 67
22 permit udp host 172.17.1.126 eq 67 172.17.5.0 0.0.0.127 range 67 68
23 permit icmp host 172.17.1.126 172.16.0.0 0.15.255.255
24 permit icmp 172.16.0.0 0.15.255.255 host 172.17.1.126
remark DNS
51 permit udp 172.17.5.0 0.0.0.255 host 172.17.1.126 eq 53
52 permit udp host 172.17.1.126 eq 53 172.17.5.0 0.0.0.255
remark HSRP
71 permit ip 172.17.5.0 0.0.0.127 host 224.0.0.102
72 permit ip host 224.0.0.102 172.17.5.0 0.0.0.127
73 permit ip host 224.0.0.102 host 224.0.0.102
remark DENY_ANY
100 deny ip any any
exit


exit

wr

exit
