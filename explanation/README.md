# НЕТОЛОГИЯ
# Дипломная работа профессии "Сетевой инженер"

### Пояснительная записка

- [Инфраструктурный сервер](#Инфраструктурный-сервер)
- [WLAN контроллер](#WLAN-контроллер)
- [Сервер телефонии](#Сервер-телефонии)
- [Уровень доступа](#Уровень-доступа)
- [Уровень ядра](#Уровень-ядра)
- [Межсетевой экран](#Межсетевой-экран)
- [Бордеры](#Бордеры)

---

### Инфраструктурный сервер

<img src="source/01-main_infr_serv_01.png">

***DHCP***  
DHCP-сервер который раздает IP адреса каждому устройству, подключенному в локальную сеть.
Тут отмечу что все устройства получают в качестве настроек приватный DNS, только абоненты гостевого WI-Fi получают публичный DNS.

***DNS***  
Имеет две A-записи:
- netology.ru - наш  веб сервер.
- public-dns.com - публичный DNS.
Две NS-записи для доменов .ru и .com, ссылаются на публичный DNS.

Пользователи из внутренней сети пользуются приватным DNS и netology.ru у них разрешается из внутренней сети - 172.16.100.2.
Исключение пользователи гостевого Wi-Fi, они пользуются публичным DNS, и имя netology.ru у них резолвится как наш публичный адрес - 172.1.0.2. Далее работает проброс портов.

***SYSLOG***  
Syslog-коллектор, получает и хранит логи со всех АСО.

***AAA***  
AAA-сервер, хранил логин/пароль для:
- Абонентов Wi-Fi - radius.
- Подключения администратора к АСО по SSH - tacasc+.

***NTP***  
NTP-сервер, АСО настроено обращаться к нему, для синхронизации времени.
Крайне криво работает, надо постоянно тыркать, включать-выключать, чтобы АСО начало с ним обновляться, поэтому верификация не настраивалась.

***SSH***  
Является рабочим местом администратора, АСО настроено так, что только с него можно подключиться к консоли по SSH.

---

### WLAN контроллер

<img src="source/02-main_wlc_01.png">

По заданию надо было использовать WLC-2504, но т.к. он не умеет работать с VLAN, использовался WLC-PT.

Настроен SID для главного офиса и для филиала, с указанием каким VLAN тегировать трафик. За логином и паролем обращается к AAA-серверу.

И настроены AP-группы, точка доступа в главном офисе раздает свой SID, точка доступа в филиале раздает SID для филиала.

---

### Сервер телефонии

<img src="source/03-main_voip_serv_01.png">

VoIP шлюз реализованный на маршрутизаторе Cisco 2811 посредством SCCP.

Настроено два профиля для телефона в центральном офисе и филиале.

---

### Уровень доступа

<img src="source/04-main_access_layer.png" width="800">

***Базовые настройки***  
Настроены timezone и связь с ntp-сервером.  
Настроен сервер для резолва имен.  
Настроена отправка SYSLOG на сервер.  
Настроен шлюз по умолчанию.  
Неиспользуемые порты выключены.  

***Подключение***  
Настроены линейные интерфейсы.  
Настроен SSH, к VLAN интерфейсу с рабочего места администратора.  
Как и на всем АСО настроена AAA модель. Локальный пользователь для подключения к консоли, tacasc+ для подключения по SSH.  

***STP***  
Настроен rapid-pvst для всех VLAN.  
Приоритет одинаковый у всех коммутаторов доступа, но ниже чем у коммутаторов ядра. Аплинк в сторону резервного коммутатора ядра с увеличенной стоимостью, чтобы блокировался, когда основной коммутатор ядра работает.  
Порты для подключения оконечного оборудования в режиме portfast, чтобы не участвовали в построении STP, и bpduguard чтобы не получать BPDU.  

***DHCP snooping***  
Настроен dhcp snooping для для всех VLAN.  
Указаны порты с которых можно принимать dhcp-дейтаграммы. Ну и ввиду ограниченного функционала CPT allow-untrusted для 82 опции.  

***Port security***  
На интерфейсах включен для подключения оконечного оборудования режим port-security в режиме изучения до 2-х MAC адресов и блокировки и оповещения при нарушении.  
По заданию требуется изучать только до 2-х MAC адресов. Но в случае подключения телефона и компьютера мостом, приходится увеличить до трех, т.к. у телефона уже будет два MAC-адресам.  
Ну и для Wi-Fi без ограничений, думаю не предполагается ограничивать количество абонентов гостевого Wi-Fi.  

---

### Уровень ядра

<img src="source/05-main_core_layer.png" width="800">

***Базовые настройки***  
Настроены timezone и связь с ntp-сервером.  
Настроен сервер для резолва имен.  
Настроена отправка SYSLOG на сервер.  
Неиспользуемые порты выключены.  

***Ответ на вопрос***  
Касательно возможности подключения 5 дополнительных коммутаторов доступа, проблем с этим нет, у коммутаторов ядра еще 18 свободных портов.  

***Подключение***
Настроены линейные интерфейсы.  
Настроен SSH, к loopback интерфейсу с рабочего места администратора.  
Как и на всем АСО настроена AAA модель. Локальный пользователь для подключения к консоли, tacasc+ для подключения по SSH.  

***STP***  
Настроен rapid-pvst для всех VLAN.  
Primary приоритет у основного коммутатора и secondary у резервного.  

***DHCP snooping***  
Настроен dhcp snooping для для всех VLAN.  
Указаны порты, с которых можно принимать dhcp-дейтаграммы. Ну и ввиду ограниченного функционала CPT allow-untrusted для 82 опции.  

***SVI***  
Настроены VLAN интерфейсы:  
- Настроено резервирование шлюза по-умолчанию по протоколу HSRP, приоритет для основного коммутатора с мониторингом аплинка и “вытеснением”.  
- Настроен helper для отправки dhcp-запросов на инфраструктурный сервер.  
- Настроены ACL согласно [таблице из задания](https://github.com/netology-code/ntw-diplom/blob/main/README.md).  

***LACP***  
Два горизонтальных канала объеденены в L2 агрегированных канала по протоколу LACP, на основном коммутаторе в режиме active.  

***OSPF***  
На коммутаторах ядра включена маршрутизация.  
Настроен процесс динамической маршрутизации OSPF. Коммутаторы ядра в тупиковой зоне, точнее nssa, т.е. они видят маршруты анонсированные в своей зоне и от BDR они получают маршрут по умолчанию.  
На коммутаторах ядра анонсируются маршруты до сетей центрального офиса и до MGMT интерфейсов, все пассивные интерфейсы, можно было бы заниматься ре-дистрибуцией.  
Для горизонтальной связи коммутаторов добавлен отдельный VLAN интерфейс, чтобы не расширять ACL для VLAN которые должны быть по заданию.  

---

### Межсетевой экран

<img src="source/06-main_firewall_layer.png" width="800">

Функционал Cisco ASA в CPT очень ограничен, так что особых настроек здесь нет.

***Базовые настройки***  
Настроены timezone и связь с ntp-сервером.  
Неиспользуемые порты выключены.  

***Подключение***  
Для работы в консоли просто пароль для перехода в привилегированный режим.  
Настроен SSH, подключение к физическому интерфейсу (т.к. нет loopback интерфейсов) с рабочего места администратора.  
Tacasc+ не работает, так что авторизация по локальной учетной записи при подключении по SSH.  

***Фильтрация***  
Настроена фильтрация на основе зон:
- OUTSIDE интерфейс, в сторону бордеров. Security-level 0 - входящий трафик в другие зоны по умолчанию запрещен. Разрешения на входящий трафик устанавливаются ACLками - служебный и пользовательский трафик из филиала и трафик до веб-сервера.
- INSIDE интерфейс, в сторону ядра. Security-level 100 входящий трафик в другие зоны по умолчанию разрешен.
- DMZ интерфейс, в сторону веб-сервера. Security-level 50 - запрещен входящий трафик в INSIDE.

***OSPF***  
Запущен OSPF процесс, по сути задача просто передавать маршруты между бордерами и коммутаторами ядра.  
ASA в тупиковой зоне, точнее nssa, имеют только маршруты анонсированные в этой зоне и маршрут по умолчанию в сторону бордеров.  

---

### Бордеры

<img src="source/07-all_border_layer.png" width="800">

***Базовые настройки***  
Настроены timezone и связь с ntp-сервером.  
Настроен сервер для резолва имен.  
Настроена отправка SYSLOG на сервер.  
Неиспользуемые порты выключены.  

***Подключение***  
Настроены линейные интерфейсы.  
Настроен SSH, к loopback интерфейсу с рабочего места администратора.  
Как и на всем АСО настроена AAA модель. Локальный пользователь для подключения к консоли, tacasc+ для подключения по SSH.  

***NAT***  
Настроен NAT для выхода пользователей и абонентов гостевого Wi-Fi в интернет, ACL для доступа в интернет таблице.  
Настроен PAT - проброшен порт до веб-сервера, только на основном бордере главного офиса.  
На публичном DNS есть A-запись о нашем веб сервере и публичном IP адресе на основном бордере.  

***Туннели***  
Настроены GRE туннели между бордерами центрального офиса и филиалом.  

***Ответ на вопрос 1***  
Касательно подключения дополнительных 5 офисов, в сети 172.16.2.0/24 остается еще 62 сети с префиксом /30.  

***Ответ на вопрос 2***  
Касательно опасности использовать GTE туннели в таком виде (котором можно реализовать в CPT), в том, что трафик не шифруется. Не зашифрованный служебный трафик АСО и рабочая информация гоняется через интернет, где ее может перехватывать кто угодно. Трафик внутри туннеля требуется дополнительно шифровать, например используя IPSec.  

***Маршрутизация eBGP***  
Настроен eBGP процесс для анонса своих публичных адресов в интернете и получения информации о маршрутах в интернете.  
Постарался сделать так, чтобы трафик в интернет ходил преимущественно через основной бордер. Для этого надо отслеживать состояние канала в интернет на основном бордере. Для этого на бордерах настроен EIGRP процесс, основной бордер занимаются редистрибуцией маршрутов полученных по eBGP. Для резервного бордера изменена AD для EIGRP (сделан приоритетнее eBGP), поэтому пока работает основной канал связи, резервный бордер будет направлять трафик через основной бордер.  
Если основной канал связи падает, резервный бордер переключается на маршруты полученные по eBGP. Но для эьлго потребуется перезагрузка, чтобы корректно обновилась таблица маршрутизации.  

***Маршрутизация OSPF***  
Настроен OSPF. Бордеры центрального офиса являются ABR - они анонсируют маршруты приватной сети в сторону сети центрального офиса (маршрут по умолчанию) и филиала.  
За счет изменения стоимости интерфейсов, для бордера в филиале предпочтительнее маршрут через основной бордер центрального офиса.  

***Бордер филиала***  
Бордер филиала выполняет дополнительный функционал, т.к. в филиале отсутствует уровень ядра, только уровень доступа.  
Интерфейсы в строну уровня доступа:
- настроены sub интерфейсы для VLAN филиала.
- настроен helper для отправки dhcp-запросов на инфраструктурный сервер.
- Настроены ACL согласно [таблице из задания](https://github.com/netology-code/ntw-diplom/blob/main/README.md).
