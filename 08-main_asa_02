
conf t

hostname main-asa-02

ntp server 172.17.1.126

enable password passwd level 15
username admin password passwd

aaa authentication ssh console LOCAL
aaa authentication tel console LOCAL

domain-name my.local
crypto key generate rsa general-keys modulus 1024
yes

interface GigabitEthernet1/1
description MAIN_BORDER_01
nameif OUTSIDE
security-level 0
ip address 172.16.1.10 255.255.255.252
no shutdown
exit

interface GigabitEthernet1/2
description MAIN_CORE_SW_01
nameif INSIDE
security-level 100
ip address 172.16.1.17 255.255.255.252
no shutdown
exit

interface GigabitEthernet1/3
description MAIN_WEB_SERVER_01
nameif DMZ
security-level 50
ip address 172.16.100.1 255.255.255.192
no shutdown
exit

ssh 172.17.1.126 255.255.255.128 INSIDE 

router ospf 65528
router-id 0.1.2.2
area 1 nssa no-summary
network 172.16.1.8 255.255.255.252 area 1
network 172.16.1.16 255.255.255.252 area 1
network 172.16.100.0 255.255.255.192 area 1
exit

policy-map global_policy
class inspection_default
no inspect ftp
no inspect tftp
no inspect dns preset_dns_map
inspect icmp
inspect http
inspect dns
exit

no policy-map type inspect dns preset_dns_map

! access-list OUTSIDE_ACL extended permit udp 172.16.0.0 255.240.0.0 eq 68 host 172.17.1.126 eq 67
! access-list OUTSIDE_ACL extended permit udp 172.16.0.0 255.240.0.0 host 172.17.1.126 eq 53
! access-list OUTSIDE_ACL extended permit udp 172.16.0.0 255.240.0.0 host 172.17.1.126 eq 123
! access-list OUTSIDE_ACL extended permit tcp 172.16.0.0 255.240.0.0 host 172.17.1.126 eq 49
! access-list OUTSIDE_ACL extended permit udp 172.16.0.0 255.240.0.0 host 172.17.1.126 eq 1645
! access-list OUTSIDE_ACL extended permit udp host 172.18.1.60 host 172.17.1.125 range 5246 5247
!
! access-list OUTSIDE_ACL extended permit tcp 8.8.8.0 255.255.255.0 eq 80 172.16.0.0 255.240.0.0
! access-list OUTSIDE_ACL extended permit tcp 8.8.8.0 255.255.255.0 eq 443 172.16.0.0 255.240.0.0
!
! access-list OUTSIDE_ACL extended permit tcp any 172.16.100.0 255.255.255.192 eq 80
! access-list OUTSIDE_ACL extended permit tcp any 172.16.100.0 255.255.255.192 eq 443
!
! access-list OUTSIDE_ACL extended permit ip 172.18.4.0 255.255.255.192 172.17.4.0 255.255.255.0
! access-list OUTSIDE_ACL extended permit ip 172.18.2.0 255.255.255.128 172.17.5.0 255.255.255.128
!
!!!! access-list OUTSIDE_ACL extended permit tcp 172.16.0.0 255.240.0.0 eq 22 host 172.17.1.126
!!!! access-list OUTSIDE_ACL extended permit icmp 172.16.0.0 255.240.0.0 host 172.17.1.126
!
! access-group OUTSIDE_ACL in interface OUTSIDE 
!
! access-list DMZ_ACL extended permit ip 172.16.100.0 255.255.255.192 any
! access-list DMZ_ACL permit tcp 172.16.100.0 255.255.255.192 eq 80
! access-list DMZ_ACL permit tcp 172.16.100.0 255.255.255.192 eq 443
!
! access-group DMZ_ACL in interface DMZ

object-group service BRANCH1_INFR_OBJ
service-object udp source eq 68
service-object udp destination eq 67
service-object udp destination eq 53
service-object udp destination eq 123
service-object tcp destination eq 49
service-object udp destination eq 1645
service-object icmp
exit
conf t

object-group service BRANCH1_AP_OBJ
service-object udp destination eq 5246
service-object udp destination eq 5247
exit
conf t

object-group service WEB_OBJ
service-object tcp destination eq 80
service-object tcp destination eq 443
exit
conf t

object-group service PUBLIC_DNS_OBJ
service-object udp source eq 53
exit
conf t

object-group service VOIP_OBJ
service-object tcp-udp
service-object icmp
exit
conf t

object-group service BRANCH1_USERS_OBJ
service-object tcp-udp
service-object icmp
exit
conf t

access-list OUTSIDE_ACL extended permit object-group BRANCH1_INFR_OBJ 172.16.0.0 255.240.0.0 host 172.17.1.126
access-list OUTSIDE_ACL extended permit object-group BRANCH1_AP_OBJ host 172.18.1.60 host 172.17.1.125
access-list OUTSIDE_ACL extended permit object-group WEB_OBJ any 172.16.100.0 255.255.255.192
access-list OUTSIDE_ACL extended permit object-group PUBLIC_DNS_OBJ host 8.8.8.8 host 172.17.1.126
access-list OUTSIDE_ACL extended permit object-group VOIP_OBJ 172.18.4.0 255.255.255.192 172.17.4.0 255.255.255.0
access-list OUTSIDE_ACL extended permit object-group BRANCH1_USERS_OBJ 172.18.2.0 255.255.255.128 172.17.5.0 255.255.255.128

access-group OUTSIDE_ACL in interface OUTSIDE

exit

write memory

exit
